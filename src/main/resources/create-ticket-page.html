<!doctype html>

<html lang="en" style="min-width:500px;>
<head>
    <meta charset="utf-8">

<title>Trello ticket creation</title>
<meta name="description" content="Trello ticket creation">
<meta name="author" content="Bongo">

<style type="text/css">
.form-style-3{
	max-width: 100%;
	font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
	color: #0a8073;
	font-size: 13px;
	font-weight: bold;
}
.form-style-3 label{
	display:block;
	margin-bottom: 10px;
}
.form-style-3 label > span{
	float: left;
	width: 100px;
	color: #0a8073;
	font-weight: bold;
	font-size: 13px;
	text-shadow: 1px 1px 1px #fff;
}
.form-style-3 fieldset{
	border-radius: 10px;
	-webkit-border-radius: 10px;
	-moz-border-radius: 10px;
	margin: 0px 0px 10px 0px;
	border: 1px solid #0a9176;
	padding: 20px;
	background: #f4f7f8;
	box-shadow: inset 0px 0px 15px #FFE5E5;
	-moz-box-shadow: inset 0px 0px 15px #FFE5E5;
	-webkit-box-shadow: inset 0px 0px 15px #FFE5E5;
}
.form-style-3 fieldset legend{
	color: #fff;
	border-top: 1px solid #0a9176;
	border-left: 1px solid #0a9176;
	border-right: 1px solid #0a9176;
	border-radius: 5px 5px 0px 0px;
	-webkit-border-radius: 5px 5px 0px 0px;
	-moz-border-radius: 5px 5px 0px 0px;
	background: #1abc9c;
	padding: 0px 8px 3px 8px;
	box-shadow: -0px -1px 2px #F1F1F1;
	-moz-box-shadow:-0px -1px 2px #F1F1F1;
	-webkit-box-shadow:-0px -1px 2px #F1F1F1;
	font-weight: normal;
	font-size: 12px;
}
.form-style-3 textarea{
	width:250px;
	height:100px;
}
.form-style-3 input[type=text],
.form-style-3 input[type=date],
.form-style-3 input[type=datetime],
.form-style-3 input[type=number],
.form-style-3 input[type=search],
.form-style-3 input[type=time],
.form-style-3 input[type=url],
.form-style-3 input[type=email],
.form-style-3 select,
.form-style-3 textarea{
	border-radius: 3px;
	-webkit-border-radius: 3px;
	-moz-border-radius: 3px;
	border: 1px solid #FFC2DC;
	outline: none;
	color: #8a97a0;
	padding: 5px 8px 5px 8px;
	box-shadow: inset 1px 1px 4px #FFD5E7;
	-moz-box-shadow: inset 1px 1px 4px #FFD5E7;
	-webkit-box-shadow: inset 1px 1px 4px #FFD5E7;
	background: #e8eeef;
	width:50%;
}
.form-style-3 input[type=text]:disabled,
.form-style-3 input[type=text]:read-only,
.form-style-3 input[type=date]:disabled,
.form-style-3 input[type=datetime]:disabled,
.form-style-3 input[type=number]:disabled,
.form-style-3 input[type=search]:disabled,
.form-style-3 input[type=time]:disabled,
.form-style-3 input[type=url]:disabled,
.form-style-3 input[type=email]:disabled,
.form-style-3 select:disabled,
.form-style-3 textarea:disabled{
	background: #C1C1C1;
}
.form-style-3 select:focus{
	background: #d2d9dd;
}
.form-style-3  input[type=submit],
.form-style-3  button[type=submit],
.form-style-3  input[type=button]{
	background: #1abc9c;
	border: 1px solid #C94A81;
	padding: 5px 15px 5px 15px;
	color: #FFF;
	box-shadow: inset -1px -1px 3px #FF62A7;
	-moz-box-shadow: inset -1px -1px 3px #FF62A7;
	-webkit-box-shadow: inset -1px -1px 3px #FF62A7;
	border-radius: 3px;
	border-radius: 3px;
	-webkit-border-radius: 3px;
	-moz-border-radius: 3px;
	font-weight: bold;
}
.ticketUrl,
.ticketUrl > span{
  display: none;
}
.required{
	color:red;
	font-weight:normal;
}


/* Absolute Center Spinner */
.loading {
  position: fixed;
  z-index: 999;
  overflow: show;
  margin: auto;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  width: 50px;
  height: 50px;
}

/* Transparent Overlay */
.loading:before {
  content: '';
  display: block;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(255,255,255,0.5);
}

/* :not(:required) hides these rules from IE9 and below */
.loading:not(:required) {
  /* hide "loading..." text */
  font: 0/0 a;
  color: transparent;
  text-shadow: none;
  background-color: transparent;
  border: 0;
}

.loading:not(:required):after {
  content: '';
  display: block;
  font-size: 10px;
  width: 50px;
  height: 50px;
  margin-top: -0.5em;

  border: 15px solid rgba(33, 150, 243, 1.0);
  border-radius: 100%;
  border-bottom-color: transparent;
  -webkit-animation: spinner 1s linear 0s infinite;
  animation: spinner 1s linear 0s infinite;


}

/* Animation */

@-webkit-keyframes spinner {
  0% {
    -webkit-transform: rotate(0deg);
    -moz-transform: rotate(0deg);
    -ms-transform: rotate(0deg);
    -o-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
@-moz-keyframes spinner {
  0% {
    -webkit-transform: rotate(0deg);
    -moz-transform: rotate(0deg);
    -ms-transform: rotate(0deg);
    -o-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
@-o-keyframes spinner {
  0% {
    -webkit-transform: rotate(0deg);
    -moz-transform: rotate(0deg);
    -ms-transform: rotate(0deg);
    -o-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
@keyframes spinner {
  0% {
    -webkit-transform: rotate(0deg);
    -moz-transform: rotate(0deg);
    -ms-transform: rotate(0deg);
    -o-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
</style>
</head>

<body min-width="100px">

<center>
    <div class="form-style-3">
        <form id="myForm" name="myForm" method="POST" action="/create_trello_ticket" enctype="multipart/form-data" target="dummyframe">
            <fieldset><legend>Ticket data</legend>

                <div id="boardsDiv"><label for="boards"><span>Select a board:</span>
                    <select id="boards" required name="boards" size="5">
                        <option value="5de924620282928be34d76f6,5de924620282928be34d76f7">JS SDKs</option>
                        <option value="588f0b36543eeac2b9233511,5ae9f8082577f7eb6d60b379">SDKs</option>
                        <option value="5cab78d7155c518ad76a353a,5cab7a9b2983377b7787b01d">Ultrafast Grid</option>
                        <option value="5cd7ff05ad760377c1528bf8,5cd7ff40aa40ea48c43f8d8d">Algo Bugs</option>
                        <option value="5cee20e6ed367d2da14cdabd,5cee3e1d2d449d729624e28f">Eyes App - Issues</option>
                        <option value="5f01beffc787887211ed98f1,5f01beffc787887211ed98f2">Quality team</option>
                    </select></label><br></div>

                <div id="accountDiv"><label for="account"><span>Account:</span>
                    <select id="account" required name="account" size="7"><<<ACCOUNTS>>></select></label><br></div>

                <div id="ticketTitleDiv"><label for="ticketTitle"><span>Ticket title:</span>
                    <input type="text" id="ticketTitle" name="ticketTitle" size="80" required></label><br></div>

                <div id="ticketDescriptionDiv"><label for="ticketDescription"><span>Ticket description:</span>
                    <textarea name="ticketDescription" id="ticketDescription" cols="60" rows="4" required></textarea></label><br></div>

                <div id="zendeskUrlDiv"><label for="zendeskUrl"><span>Zendesk URL:</span>
                    <input type="text" id="zendeskUrl" name="zendeskUrl" value="" readonly></label><br></div>

                <div id="customerAppUrlDiv"><label for="customerAppUrl"><span>Customer app url:</span>
                    <input type="text" id="customerAppUrl" name="customerAppUrl" size="80" required>
                    <input type="checkbox" id="isCustomerAppAvailable" name="isCustomerAppAvailable" checked=true></label><br></div>

                <div id="sdkDiv"><label for="sdk"><span>Select an SDK:</span>
                    <select id="sdk" required name="sdk" size="7"><<<SDKS>>></select></label><br></div>

                <div id="sdkVersionDiv"><label for="sdkVersion"><span>SDK version:</span>
                    <input type="text" id="sdkVersion" name="sdkVersion" required>
                    <input type="checkbox" id="isSdkVersionAvailable" name="isSdkVersionAvailable" checked=true></label><br></div>

                <div id="renderIDDiv"><label for="renderID"><span>Render ID:</span>
                    <input type="text" id="renderID" name="renderID" required>
                    <input type="checkbox" id="isRenderIDAvailable" name="isRenderIDAvailable" checked=true></label><br></div>

                <div id="linkToTestResultsDiv"><label for="linkToTestResults"><span>Link to dashboard test results:</span>
                    <textarea name="linkToTestResults" id="linkToTestResults" cols="60" rows="2" required></textarea>
                    <input type="checkbox" id="isLinkToTestResultAvailable" name="isLinkToTestResultAvailable" checked=true></label><br><br></div>

                <div id="yesDiv"><label for="yes"><span>Check if the customer app is accessible to the R&D</span>
                    <p>
                    <label for="yes"><span>Yes</span></label>
                    <input type="radio" id="yes" name="isAccessible" value="yes" required>
                    </p>
                    <p>
                    <label for="no"><span>&#10;No</span></label>
                        <input type="radio" id="no" name="isAccessible" value="no" required></p></label><br><br><br></div>


                <div id="logFilesDiv"><label for="logFiles"><span>Log files:</span>
                    <input type="file" id="logFiles" name="logFiles" required multiple>
                    <input type="checkbox" id="isLogFileAvailable" name="isLogFileAvailable" checked=true></label><br><br></div>


                <div id="reproducibleDiv"><label for="reproducible"><span>Reproducible and examples:</span>
                    <input type="file" id="reproducible" name="reproducible" required multiple>
                    <input type="checkbox" id="isReproducibleAvailable" name="isReproducibleAvailable" checked=true></label><br><br></div>

                <details>
                    <summary>Extras</summary>
                    <br><br>
                    <div id="workaroundDiv"><label for="workaround"><span>workaround:</span>
                        <input type="checkbox" id="workaround" name="workaround"><br><br>
                    <div id="blockerDiv"><label for="blocker"><span>blocker:</span>
                        <input type="checkbox" id="blocker" name="blocker">
                </details><br><br>

                <div id="loading" class="loading">Loading&#8230;</div>

                <input type="hidden" id="requestID" name="requestID" value="random">
                <input type="hidden" id="zendeskCustomerName" name="zendeskCustomerName" value="">
                <input type="hidden" id="zendeskCompanyName" name="zendeskCompanyName" value="">
                <input type="hidden" id="zendeskTier" name="zendeskTier" value="">
                <input type="hidden" id="zendeskCustomerType" name="zendeskCustomerType" value="">

                <input type="submit" id="btn-submit" value="Create ticket">
                <center><label id="ticketUrl" class="ticketUrl"><span><a href="" target="_blank">Done!</a></span></label></center>


            </fieldset></form>
    </div>
</center>

<iframe name="dummyframe" id="dummyframe" style="display: none;"></iframe>

<script>

    let requestID = Math.random();
    document.querySelector('#requestID').value = requestID;

    showLoader();
    setTimeout(() => hideLoader(), 2000);

    function changeFormForBoardEyesAppIssues () {
        const boardsSelect = document.querySelector('#boards');
        const boardName = boardsSelect.options[boardsSelect.selectedIndex].text;
        if (boardName == "Eyes App - Issues") {
            document.querySelector('#customerAppUrlDiv').style.display = "none";
            document.querySelector('#customerAppUrl').required = false;

            document.querySelector('#sdkDiv').style.display = "none";
            document.querySelector('#sdk').required = false;

            document.querySelector('#sdkVersionDiv').style.display = "none";
            document.querySelector('#sdkVersion').required = false;

            document.querySelector('#renderIDDiv').style.display = "none";
            document.querySelector('#renderID').required = false;

            document.querySelector('#linkToTestResultsDiv').style.display = "none";
            document.querySelector('#linkToTestResults').required = false;

            document.querySelector('#yesDiv').style.display = "none";
            document.querySelector('#no').required = false;
            document.querySelector('#yes').required = false;

            document.querySelector('#logFilesDiv').style.display = "none";
            document.querySelector('#logFiles').required = false;
        } else if (boardName == "Ultrafast Grid") {
            document.querySelector('#customerAppUrlDiv').style.display = "block";
            document.querySelector('#customerAppUrl').required = true;

            document.querySelector('#sdkDiv').style.display = "block";
            document.querySelector('#sdk').required = true;

            document.querySelector('#sdkVersionDiv').style.display = "block";
            document.querySelector('#sdkVersion').required = true;

            document.querySelector('#renderIDDiv').style.display = "block";
            document.querySelector('#renderID').required = true;

            document.querySelector('#linkToTestResultsDiv').style.display = "block";
            document.querySelector('#linkToTestResults').required = true;

            document.querySelector('#yesDiv').style.display = "block";
            document.querySelector('#no').required = true;
            document.querySelector('#yes').required = true;

            document.querySelector('#logFilesDiv').style.display = "block";
            document.querySelector('#logFiles').required = true;
        } else if (boardName == "Algo Bugs") {
            document.querySelector('#customerAppUrlDiv').style.display = "block";
            document.querySelector('#customerAppUrl').required = true;

            document.querySelector('#sdkDiv').style.display = "block";
            document.querySelector('#sdk').required = true;

            document.querySelector('#sdkVersionDiv').style.display = "block";
            document.querySelector('#sdkVersion').required = true;

            document.querySelector('#renderIDDiv').style.display = "none";
            document.querySelector('#renderID').required = false;

            document.querySelector('#linkToTestResultsDiv').style.display = "block";
            document.querySelector('#linkToTestResults').required = true;

            document.querySelector('#yesDiv').style.display = "block";
            document.querySelector('#no').required = true;
            document.querySelector('#yes').required = true;

            document.querySelector('#logFilesDiv').style.display = "block";
            document.querySelector('#logFiles').required = true;
        } else {
            document.querySelector('#customerAppUrlDiv').style.display = "block";
            document.querySelector('#customerAppUrl').required = true;

            document.querySelector('#sdkDiv').style.display = "block";
            document.querySelector('#sdk').required = true;

            document.querySelector('#sdkVersionDiv').style.display = "block";
            document.querySelector('#sdkVersion').required = true;

            document.querySelector('#renderIDDiv').style.display = "block";
            document.querySelector('#renderID').required = true;

            document.querySelector('#linkToTestResultsDiv').style.display = "block";
            document.querySelector('#linkToTestResults').required = true;

            document.querySelector('#yesDiv').style.display = "block";
            document.querySelector('#no').required = true;
            document.querySelector('#yes').required = true;

            document.querySelector('#logFilesDiv').style.display = "block";
            document.querySelector('#logFiles').required = true;
        }
    }

    document.querySelector('#boards').addEventListener('change', (event) => {
        changeFormForBoardEyesAppIssues();
    });

    document.querySelector('#myForm').addEventListener('submit', (e) => {
        // #### Disable submit button ####
        var submitButton = document.getElementById('btn-submit');
        submitButton.disabled = true;
        submitButton.style.background = '#C1C1C1';
        showLoader();
        var dummyFrame = document.getElementById('dummyframe');
        dummyFrame.onload = function() {
            hideLoader();
            submitButton.value = "Done!";

            request = new XMLHttpRequest();
            request.open("GET", "/get_trello_ticket_url?requestID=" + requestID, false);
            request.send();
            var ticketUrl = request.responseText;
            var ticketUrlLabel = document.querySelector('.ticketUrl span');
            ticketUrlLabel.style.display = 'block';
            var ticketUrlLink = ticketUrlLabel.querySelector('a');
            ticketUrlLink.textContent = ticketUrl;
            ticketUrlLink.href = ticketUrl;
        }
    })

    function showLoader() {
        var loading = document.getElementById('loading');
        loading.style.display = 'block';
    }

    function hideLoader() {
        var loading = document.getElementById('loading');
        loading.style.display = 'none';
    }

    function disableFieldByCheckbox (field, checkbox) {
        if (checkbox.checked) {
            field.disabled = false
          } else {
            field.disabled = true
          }
    }

    document.querySelector('#isSdkVersionAvailable').addEventListener('change', (e) => {
        const checkBox = document.querySelector('#isSdkVersionAvailable');
        const sdkVersionTextBox = document.querySelector('#sdkVersion');
        disableFieldByCheckbox(sdkVersionTextBox, checkBox);
    })

    document.querySelector('#isCustomerAppAvailable').addEventListener('change', (e) => {
        const checkBox = document.querySelector('#isCustomerAppAvailable');
        const customerAppTextBox = document.querySelector('#customerAppUrl');
        disableFieldByCheckbox(customerAppTextBox, checkBox);
    })

    document.querySelector('#isLinkToTestResultAvailable').addEventListener('change', (e) => {
        const checkBox = document.querySelector('#isLinkToTestResultAvailable');
        const testResultsTextBox = document.querySelector('#linkToTestResults');
        disableFieldByCheckbox(testResultsTextBox, checkBox);
    })

    document.querySelector('#isLogFileAvailable').addEventListener('change', (e) => {
        const checkBox = document.querySelector('#isLogFileAvailable');
        const logFileUpload = document.querySelector('#logFiles');
        disableFieldByCheckbox(logFileUpload, checkBox);
    })

    document.querySelector('#isReproducibleAvailable').addEventListener('change', (e) => {
        const checkBox = document.querySelector('#isReproducibleAvailable')
        const reproducibleFileUpload = document.querySelector('#reproducible');
        disableFieldByCheckbox(reproducibleFileUpload, checkBox);
    })

    document.querySelector('#isRenderIDAvailable').addEventListener('change', (e) => {
        const checkBox = document.querySelector('#isRenderIDAvailable')
        const renderIdTextBox = document.querySelector('#renderID');
        disableFieldByCheckbox(renderIdTextBox, checkBox);
    })

    function string_to_slug (str) {
        str = str.replace(/^\s+|\s+$/g, '');
        str = str.toLowerCase();
        var from = "àáäâèéëêìíïîòóöôùúüûñç·/_,:;";
        var to   = "aaaaeeeeiiiioooouuuunc------";
        for (var i=0, l=from.length ; i<l ; i++) {
            str = str.replace(new RegExp(from.charAt(i), 'g'), to.charAt(i));
        }
        str = str.replace(/[^a-z0-9 -]/g, '')
            .replace(/\s+/g, '-')
            .replace(/-+/g, '-');
        return str;
    }

    var undefinedString = "undefined";

    window.addEventListener("message", (event) => {
        console.log(event.data);
        if (event.data.includes("accountName:")) {
            var accountName = event.data.split(":")[1];
            if (accountName != undefinedString) {
                var select = document.querySelector("#account");
                var i;
                for (i = 0; i < select.options.length; i++) {
                    if (select.options[i].text == accountName) {
                        break;
                    }
                }
                select.selectedIndex = i;
            }
        }
        if (event.data.includes("boardName:")) {
            var boardName = string_to_slug(event.data.split(":")[1]);
            if (boardName != undefinedString) {
                var select = document.querySelector("#boards");
                var i;
                for (i = 0; i < select.options.length; i++) {
                    var boardSlug = string_to_slug(select.options[i].text);
                    if (boardSlug == boardName) {
                        break;
                    }
                }
                select.selectedIndex = i;
                changeFormForBoardEyesAppIssues();
            }
        }
        if (event.data.includes("zendeskCustomerName:")) {
            var zendeskCustomerName = event.data.split(":")[1];
            if (zendeskCustomerName != undefinedString) {
                document.querySelector('#zendeskCustomerName').value = zendeskCustomerName;
            }
        }
        if (event.data.includes("zendeskCompanyName:")) {
            var zendeskCompanyName = event.data.split(":")[1];
            if (zendeskCompanyName != undefinedString) {
                document.querySelector('#zendeskCompanyName').value = zendeskCompanyName;
            }
        }
        if (event.data.includes("zendeskUrl:")) {
            var zendeskUrlArray = event.data.split(":");
            if (zendeskUrlArray[1] != undefinedString) {
                var zendeskUrl = zendeskUrlArray[1] + ":" + zendeskUrlArray[2];
                document.querySelector('#zendeskUrl').value = zendeskUrl;
            }
        }
        if (event.data.includes("zendeskTier:")) {
            var zendeskTier = event.data.split(":")[1];
            if (zendeskTier != undefinedString) {
                document.querySelector('#zendeskTier').value = zendeskTier;
            }
        }
        if (event.data.includes("zendeskCustomerType:")) {
            var zendeskCustomerType = event.data.split(":")[1];
            if (zendeskCustomerType != undefinedString) {
                document.querySelector('#zendeskCustomerType').value = zendeskCustomerType;
            }
        }
    });


</script>

</body>
</html>